<!DOCTYPE html>
        <html lang="ar" dir="rtl">
          <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>ÙØ§ØªÙˆØ±Ø© ${Date.now()} - Ø³Ù†Ø§Ø¨Ù„</title>
            <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
            <style>
              * { 
                margin: 0; 
                padding: 0; 
                box-sizing: border-box; 
              }
              
              body { 
                font-family: 'Cairo', 'Arial', sans-serif; 
                background: white;
                padding: 0;
                direction: rtl; 
                text-align: right;
                font-size: 12px;
                color: #333;
                line-height: 1.4;
              }
              
              .invoice-container {
                width: 80mm;
                max-width: 80mm;
                margin: 0 auto;
                background: white;
                padding: 4mm;
                font-size: 10px;
                box-shadow: 0 0 10px rgba(0,0,0,0.1);
                border-radius: 3mm;
              }
              
              .header {
                text-align: center;
                margin-bottom: 6mm;
                border-bottom: 3px solid #ff69b4;
                padding-bottom: 4mm;
                background: linear-gradient(135deg, #ff69b4, #ff8fab);
                border-radius: 3mm 3mm 0 0;
                margin: -4mm -4mm 6mm -4mm;
                padding: 4mm;
                color: white;
              }
              
              .logo {
                font-size: 18px;
                font-weight: 900;
                margin-bottom: 2mm;
                text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
              }
              
              .tagline {
                font-size: 8px;
                margin-bottom: 2mm;
                opacity: 0.9;
              }
              
              .invoice-title {
                font-size: 14px;
                font-weight: 700;
                margin-bottom: 1mm;
              }
              
              .invoice-number {
                font-size: 10px;
                background: rgba(255,255,255,0.2);
                padding: 1mm 2mm;
                border-radius: 2mm;
                display: inline-block;
              }
              
              .customer-info {
                margin-bottom: 6mm;
                padding: 3mm;
                background: #fff5f8;
                border-radius: 2mm;
                border-right: 3px solid #ff69b4;
              }
              
              .customer-row {
                display: flex;
                justify-content: space-between;
                margin-bottom: 1mm;
                font-size: 8px;
              }
              
              .customer-label {
                font-weight: 600;
                color: #ff69b4;
              }
              
              .customer-value {
                color: #333;
              }
              
              .date-time {
                text-align: center;
                margin-bottom: 4mm;
                font-size: 7px;
                color: #666;
                border-bottom: 1px dashed #ddd;
                padding-bottom: 2mm;
              }
              
              .products-table {
                width: 100%;
                border-collapse: collapse;
                margin-bottom: 4mm;
                font-size: 7px;
              }
              
              .products-table th {
                background: #ff69b4;
                color: white;
                padding: 1.5mm 0.5mm;
                font-weight: 600;
                text-align: center;
                font-size: 7px;
              }
              
              .products-table td {
                padding: 1mm 0.5mm;
                text-align: center;
                border-bottom: 1px solid #eee;
                font-size: 7px;
              }
              
              .product-name {
                text-align: right;
                font-weight: 500;
              }
              
              .totals-section {
                margin-bottom: 4mm;
                font-size: 8px;
              }
              
              .total-row {
                display: flex;
                justify-content: space-between;
                padding: 0.8mm 0;
                border-bottom: 1px solid #eee;
              }
              
              .total-row.grand-total {
                border-top: 2px solid #ff69b4;
                border-bottom: 2px solid #ff69b4;
                font-weight: 700;
                font-size: 10px;
                color: #ff69b4;
                padding: 1.5mm 0;
              }
              
              .wallet-info {
                background: #f0f8ff;
                padding: 2mm;
                border-radius: 2mm;
                margin-bottom: 4mm;
                font-size: 7px;
                border-right: 3px solid #4a90e2;
              }
              
              .wallet-row {
                display: flex;
                justify-content: space-between;
                margin-bottom: 1mm;
              }
              
              .wallet-label {
                font-weight: 600;
                color: #4a90e2;
              }
              
              .footer {
                text-align: center;
                padding: 2mm 0;
                border-top: 2px solid #ff69b4;
                font-size: 7px;
                color: #666;
              }
              
              .thank-you {
                font-size: 9px;
                font-weight: 600;
                color: #ff69b4;
                margin-bottom: 2mm;
              }
              
              .contact-info {
                font-size: 6px;
                color: #999;
                margin-bottom: 3mm;
              }
              
              .qr-code-area {
                text-align: center;
                margin-top: 2mm;
                padding: 1.5mm;
                border: 1px dashed #ccc;
                background: #f9f9f9;
                border-radius: 2mm;
              }
              
              .qr-code-area img {
                width: 80px;
                height: 80px;
                margin: 0 auto;
                display: block;
              }
              
              .qr-code-text {
                font-size: 6px;
                color: #999;
                margin-top: 1mm;
              }
              
              @media print {
                body { 
                  padding: 0; 
                  margin: 0;
                }
                .invoice-container {
                  width: 58mm;
                  max-width: 58mm;
                  padding: 2mm;
                }
              }
            </style>
          </head>
          <body>
            <div class="invoice-container">
              <div class="header">
                <div class="logo">ğŸŒ¸ Ø³Ù†Ø§Ø¨Ù„ ğŸŒ¸</div>
                <div class="tagline">Ù…ÙŠÙƒ Ø£Ø¨ & Ø¹Ø·ÙˆØ± Ø­Ø±ÙŠÙ…ÙŠ</div>
                <div class="invoice-title">ÙØ§ØªÙˆØ±Ø© Ù…Ø¨ÙŠØ¹Ø§Øª</div>
                <div class="invoice-number">Ø±Ù‚Ù…: ${Date.now()}</div>
              </div>
              
              <div class="customer-info">
                <div class="customer-row">
                  <span class="customer-label">Ø§Ù„Ø¹Ù…ÙŠÙ„:</span>
                  <span class="customer-value">${selectedCustomer.name}</span>
                </div>
                <div class="customer-row">
                  <span class="customer-label">Ø§Ù„Ù‡Ø§ØªÙ:</span>
                  <span class="customer-value">${selectedCustomer.phone}</span>
                </div>
                <div class="customer-row">
                  <span class="customer-label">Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©:</span>
                  <span class="customer-value">${selectedCustomer.wallet_balance?.toFixed(2) || '0.00'} Ø¬Ù†ÙŠÙ‡</span>
                </div>
              </div>
              
              <div class="date-time">
                Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date().toLocaleDateString('en-US')}<br>
                Ø§Ù„ÙˆÙ‚Øª: ${new Date().toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit', hour12: true})}
              </div>
              
              <table class="products-table">
                <thead>
                  <tr>
                    <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                    <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                    <th>Ø§Ù„Ø³Ø¹Ø±</th>
                    <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                  </tr>
                </thead>
                <tbody>
                  ${invoiceItems.map(item => `
                    <tr>
                      <td class="product-name">${item.productName}</td>
                      <td>${item.quantity}</td>
                      <td>${item.price.toFixed(2)}</td>
                      <td>${item.total.toFixed(2)}</td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
              
              <div class="totals-section">
                <div class="total-row">
                  <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ù‚Ø¨Ù„ Ø§Ù„Ø®ØµÙ…:</span>
                  <span>${subtotal.toFixed(2)} Ø¬Ù†ÙŠÙ‡</span>
                </div>
                ${discount > 0 ? `
                <div class="total-row">
                  <span>Ø§Ù„Ø®ØµÙ… ${discountType === "percentage" ? `(${discount}%)` : `(${discount} Ø¬Ù†ÙŠÙ‡)`}:</span>
                  <span>-${discountAmount.toFixed(2)} Ø¬Ù†ÙŠÙ‡</span>
                </div>
                ` : ''}
                <div class="total-row">
                  <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…:</span>
                  <span>${total.toFixed(2)} Ø¬Ù†ÙŠÙ‡</span>
                </div>
                ${walletPayment > 0 ? `
                <div class="total-row">
                  <span>Ø§Ù„Ø¯ÙØ¹ Ù…Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©:</span>
                  <span>-${walletPayment.toFixed(2)} Ø¬Ù†ÙŠÙ‡</span>
                </div>
                ` : ''}
                <div class="total-row grand-total">
                  <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
                  <span>${(total - walletPayment).toFixed(2)} Ø¬Ù†ÙŠÙ‡</span>
                </div>
              </div>
              
              ${(walletPayment > 0 || walletAdd > 0) ? `
              <div class="wallet-info">
                ${walletPayment > 0 ? `
                <div class="wallet-row">
                  <span class="wallet-label">ØªÙ… Ø§Ù„Ø¯ÙØ¹ Ù…Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©:</span>
                  <span>${walletPayment.toFixed(2)} Ø¬Ù†ÙŠÙ‡</span>
                </div>
                ` : ''}
                ${walletAdd > 0 ? `
                <div class="wallet-row">
                  <span class="wallet-label">Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ø­ÙØ¸Ø©:</span>
                  <span>${walletAdd.toFixed(2)} Ø¬Ù†ÙŠÙ‡</span>
                </div>
                ` : ''}
              </div>
              ` : ''}
              
              <div class="footer">
                <div class="thank-you">ğŸŒ¸ Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ¹Ø§Ù…Ù„ÙƒÙ… Ù…Ø¹Ù†Ø§ ğŸŒ¸</div>
                <div class="contact-info">
                  Ù‡Ø§ØªÙ: 0123456789 | ÙˆØ§ØªØ³Ø§Ø¨: 0123456789<br>
                  Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: Ø´Ø§Ø±Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØŒ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©<br>
                  Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„: 9 Øµ - 10 Ù…
                </div>
              </div>
              
              <div class="qr-code-area">
                <img src="${qrCodeDataURL}" alt="QR Code" />
                <div class="qr-code-text">Ø³Ù†Ø§Ø¨Ù„ - Ù…ÙŠÙƒ Ø£Ø¨ & Ø¹Ø·ÙˆØ± Ø­Ø±ÙŠÙ…ÙŠ</div>
              </div>
            </div>
          </body>
        </html>